# JokemGym Template System ğŸ‹ï¸â€â™‚ï¸

Este repositorio es un **TEMPLATE WHITE-LABEL** diseÃ±ado para crear instancias independientes de aplicaciones de gestiÃ³n para gimnasios.

## ğŸ“‹ Prerrequisitos

Antes de comenzar, asegÃºrate de tener instalado:

*   **Node.js 18+** (Requerido para Next.js 15).
*   **Cuenta en Supabase:** Debes tener una cuenta activa para crear el backend.

## ğŸš€ Setup Inicial

1.  Clona el repositorio y navega a la carpeta del frontend:
    ```bash
    cd ui
    ```

2.  Instala las dependencias y el paquete de variables de entorno:
    ```bash
    npm install
    npm install dotenv
    ```

## ğŸ”‘ Variables de Entorno

Crea un archivo llamado `.env.local` en la carpeta `ui/` basado en el siguiente ejemplo.

**Archivo: `ui/.env.local`**
```env
# ConexiÃ³n a Supabase
NEXT_PUBLIC_SUPABASE_URL=https://tu-proyecto.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=tu-anon-key-publica

# Rol de Servicio (NECESARIO para scripts de despliegue y administraciÃ³n)
# PRECAUCIÃ“N: NO agregues NEXT_PUBLIC_ al inicio. Esta clave es secreta.
SUPABASE_SERVICE_ROLE_KEY=tu-service-role-key-secreta
```

Puedes obtener estas claves en tu Dashboard de Supabase: `Project Settings > API`.

## â˜ï¸ ConexiÃ³n a la Nube (CRÃTICO)

Para que el despliegue de la base de datos funcione, debes vincular tu entorno local con el proyecto de Supabase en la nube.

1.  Inicia sesiÃ³n en la CLI de Supabase:
    ```bash
    npx supabase login
    ```
    *Sigue las instrucciones en el navegador para autorizar.*

2.  Vincula el proyecto (necesitarÃ¡s el `Project Ref` que se encuentra en la URL de tu dashboard o en Settings):
    ```bash
    npx supabase link --project-ref TU_ID_DE_PROYECTO
    ```
    > **Nota:** Se te pedirÃ¡ la contraseÃ±a de la base de datos de tu proyecto. IngrÃ©sala para completar la vinculaciÃ³n.

## ğŸ“¦ Despliegue

Una vez configurado el entorno y vinculado el proyecto, despliega la estructura de la base de datos y los datos semilla (seed):

```bash
npm run deploy:tenant
```

Este comando:
1.  Construye la configuraciÃ³n del tenant.
2.  Empuja (`db push`) las migraciones a Supabase.
3.  Ejecuta los scripts de seed para poblar datos iniciales (membresÃ­as, etc.).

## ğŸ‘¤ Primer Usuario

El sistema de autenticaciÃ³n utiliza **Supabase Auth**. 

**IMPORTANTE:** El primer usuario administrador debe crearse manualmente desde la nube:

1.  Ve a tu Dashboard de Supabase.
2.  Entra a la secciÃ³n **Authentication > Users**.
3.  Haz clic en **Add User** -> **Create New User**.
4.  Ingresa el email y contraseÃ±a deseados.
5.  Confirma la creaciÃ³n (si tienes habilitado "Confirm email", valida manualmente o desactiva la opciÃ³n en Providers > Email para pruebas).

Â¡Listo! Ahora puedes iniciar sesiÃ³n en la aplicaciÃ³n con esas credenciales.

---

## ğŸ› ï¸ Comandos Ãštiles

| Comando | DescripciÃ³n |
| :--- | :--- |
| `npm run dev` | Inicia el servidor de desarrollo local. |
| `npm run deploy:tenant` | Despliega cambios de DB y configuraciÃ³n a la nube. |
| `npm run tenant:build` | Regenera la configuraciÃ³n sin desplegar. |


## ğŸ†˜ SoluciÃ³n de Problemas

* **Error: `relation "payments" does not exist`**
    * **Causa:** El comando `deploy:tenant` fallÃ³ al subir las tablas.
    * **SoluciÃ³n:** Ejecuta `npx supabase link --project-ref TU_ID` nuevamente y asegÃºrate de poner el password correcto de la DB.

* **Error 400 en el Dashboard (Bad Request)**
    * **Causa:** Discrepancia entre las columnas de la BD y el Frontend.
    * **SoluciÃ³n:** Si modificaste el SQL manualmentne, asegÃºrate de que la tabla `payments` use la columna `date` y `measurements` use la columna `fecha`.